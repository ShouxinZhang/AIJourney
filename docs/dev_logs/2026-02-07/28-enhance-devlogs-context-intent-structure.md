# 28 - 强化 dev_logs 对话可追溯结构（背景与意图解析）

## 对话记录

### 第 1 轮
- 背景: 现有 `dev-logs` Skill 已较完善，但对话记录字段仍偏简略，回看上下文成本高。
- 用户:
  > 目前的dev_logs Skills已经比较完善，但是我发现还有一个问题
  > 就是说，用户的对话记录，其实还是应该有一个背景
  > 对，就是说一个总的背景，然后还需要有增加一个用户的意图解析部分
  > 最终应该是:
  > 对话记录
  > 背景: xxx
  > 用户: xxx
  > 用户的意图解析: xxx
  > LLM思考摘要: xxx
  > 循环 ....
- 用户的意图解析: 用户希望把对话日志从“聊天摘录”升级为“可复盘的结构化决策记录”，避免隔几天后无法快速理解当时决策上下文。
- LLM思考摘要: 采用最小改动更新 `dev-logs` 与 `local-dev-workflow` 两个 Skill 规范，统一新字段与记录流程，不扩散到业务代码层。

### 第 2 轮
- 背景: 已给出最小改动方案，等待实施确认。
- 用户:
  > 就是为什么要做这一点呢？因为我发现没有背景和意图解析的话，可能过了几天就看不懂了
- 用户的意图解析: 用户补充业务动因，强调该改动的核心价值是提升跨时间回看和交接可读性。
- LLM思考摘要: 基于该确认直接执行文档改造，完成质量检查并回写开发日志。

**修改时间**: 2026-02-07 16:19:53

## 概述

将 `dev-logs` 对话记录规范升级为“背景 + 用户原文 + 用户意图解析 + LLM思考摘要”的循环结构，提升日志在跨时间回看和团队交接场景下的可理解性。

## 修改文件清单

| 文件 | 操作 | 修改时间 | 说明 |
|------|------|----------|------|
| `.agents/skills/dev-logs/SKILL.md` | 修改 | 2026-02-07 16:19:07 | 升级对话记录格式，新增背景/意图解析/LLM思考摘要循环规范与示例 |
| `.agents/skills/local-dev-workflow/SKILL.md` | 修改 | 2026-02-07 16:19:11 | 同步 Step 7 必填项，避免总流程与 `dev-logs` Skill 规范不一致 |
| `docs/dev_logs/2026-02-07/28-enhance-devlogs-context-intent-structure.md` | 新增 | 2026-02-07 16:19:53 | 记录本轮规范升级与验证结果 |

## 具体变更描述

### 问题
- 旧格式仅记录“用户原文 + LLM 摘要”，缺少任务背景和用户真实诉求拆解。
- 日志在隔天回看时容易出现“看得见结论、看不懂原因”的信息断层。

### 方案
- 在 `dev-logs` Skill 中将“对话记录”强制为按轮次循环的四字段结构：
  - `背景`
  - `用户`（引用块原文）
  - `用户的意图解析`
  - `LLM思考摘要`
- 在 `local-dev-workflow` Step 7 同步声明该结构为开发日志必填内容。
- 保留“用户原文必须完整记录”的硬约束，新增“意图解析基于原文、避免过度推断”的约束。

### 影响范围
- 影响后续所有新开发日志的记录方式（文档规范层）。
- 不影响前端功能、数据结构和运行时行为。
- 业务收益：提升历史决策可解释性，减少后续沟通和排查成本。

## 验证结果
- ✔ `bash scripts/check_errors.sh` 通过（依赖检查 / TypeScript / ESLint / Vite Build 全通过）

## Git 锚点
- branch: `main`
- commit: `N/A`（本轮仅完成规范与文档更新，未按本轮任务要求执行提交）
- tag/backup: `N/A`
